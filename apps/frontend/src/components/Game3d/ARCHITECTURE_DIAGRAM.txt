â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         3D PONG ARCHITECTURE OVERVIEW                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               GAME BACKEND                                     â”‚
â”‚                            (apps/gameback)                                     â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GameWorld (engine/world.ts)                                              â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  â€¢ Physics simulation: 120 Hz tick rate                                 â”‚ â”‚
â”‚  â”‚  â€¢ Ball movement, collision detection                                   â”‚ â”‚
â”‚  â”‚  â€¢ Paddle movement (based on player input)                              â”‚ â”‚
â”‚  â”‚  â€¢ Powerup spawning (split, blackout, blackhole)                        â”‚ â”‚
â”‚  â”‚  â€¢ Skill activation (smash, dash)                                       â”‚ â”‚
â”‚  â”‚  â€¢ Score tracking and game over logic                                   â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  State: { leftPaddle, rightPaddle, balls[], score, powerUps[], ... }   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GameSession (session/session.ts)                                         â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  â€¢ Manages WebSocket connections (left, right, spectators)              â”‚ â”‚
â”‚  â”‚  â€¢ Broadcasts PublicState at 60 Hz to all clients                       â”‚ â”‚
â”‚  â”‚  â€¢ Receives player input: { type: 'input', up: bool, down: bool }      â”‚ â”‚
â”‚  â”‚  â€¢ Stores match to database with is_3d flag                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ WebSocket
                                â”‚ wss://host/game/:roomId
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                 â”‚
                â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      2D CLIENT (Canvas)       â”‚   â”‚      3D CLIENT (Babylon.js)      â”‚
â”‚  apps/frontend/.../PongGame   â”‚   â”‚   apps/frontend/.../Game3d       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               â”‚   â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WSClient.ts             â”‚ â”‚   â”‚  â”‚ WSClient.ts               â”‚  â”‚
â”‚  â”‚ (shared WebSocket)      â”‚ â”‚   â”‚  â”‚ (same shared client)      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ onState: (state) => {   â”‚ â”‚   â”‚  â”‚ onState: (state) => {     â”‚  â”‚
â”‚  â”‚   updatePaddles()       â”‚ â”‚   â”‚  â”‚   connector.update(state) â”‚  â”‚
â”‚  â”‚   updateBall()          â”‚ â”‚   â”‚  â”‚ }                         â”‚  â”‚
â”‚  â”‚ }                       â”‚ â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚              â–¼                  â”‚
â”‚              â–¼                â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚  â”‚ Game3dConnector.ts        â”‚  â”‚
â”‚  â”‚ PongRenderer.ts         â”‚ â”‚   â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚                         â”‚ â”‚   â”‚  â”‚ â€¢ convert2DXto3DX()       â”‚  â”‚
â”‚  â”‚ drawPaddle(x, y, w, h)  â”‚ â”‚   â”‚  â”‚ â€¢ convert2DYto3DZ()       â”‚  â”‚
â”‚  â”‚ drawBall(x, y, r)       â”‚ â”‚   â”‚  â”‚ â€¢ updatePaddlePosition()  â”‚  â”‚
â”‚  â”‚ drawPowerUp(x, y, type) â”‚ â”‚   â”‚  â”‚ â€¢ updateBallPosition()    â”‚  â”‚
â”‚  â”‚                         â”‚ â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ Canvas 2D Context       â”‚ â”‚   â”‚              â–¼                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                               â”‚   â”‚  â”‚ Babylon.js Scene          â”‚  â”‚
â”‚  Renders:                     â”‚   â”‚  â”‚                           â”‚  â”‚
â”‚  â€¢ Flat sprites               â”‚   â”‚  â”‚ paddleOwner.position.z    â”‚  â”‚
â”‚  â€¢ 2D particles               â”‚   â”‚  â”‚ paddleOpponent.position.z â”‚  â”‚
â”‚  â€¢ Score overlay              â”‚   â”‚  â”‚ ball.position.x/y/z       â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚                           â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚ 3D Models:                â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚ â€¢ stadium.gltf            â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚ â€¢ Paddles (meshes)        â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚ â€¢ Ball (sphere)           â”‚  â”‚
â”‚                               â”‚   â”‚  â”‚ â€¢ Background sphere       â”‚  â”‚
â”‚                               â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COORDINATE SYSTEMS:

2D Pong (Canvas):                    3D Stadium (Babylon.js):
                                     
    (0,0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (1920,0)               Y â†‘ (up)
      â”‚                   â”‚                   â”‚
      â”‚   â”Œâ”€â”      â”Œâ”€â”   â”‚                   â”‚
      â”‚   â”‚Lâ”‚  â—   â”‚Râ”‚   â”‚                   â””â”€â”€â”€â†’ X (horizontal)
      â”‚   â””â”€â”˜      â””â”€â”˜   â”‚                  â•±
      â”‚                   â”‚                 â•±
   (0,1080) â”€â”€â”€â”€ (1920,1080)              Z (depth)

   Left Paddle: x=30, y=varies          Left: x=-910, y=0, z=mapped(y)
   Right Paddle: x=1890, y=varies       Right: x=+910, y=0, z=mapped(y)
   Ball: x=varies, y=varies             Ball: x=mapped(x), y=0, z=mapped(y)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MESSAGE FLOW:

1. Player Input:
   Keyboard Event â†’ Game3d.keys â†’ connector.getPaddleIntention()
   â†’ WSClient.sendInput(up, down) â†’ Server

2. Game State Update:
   Server broadcasts â†’ WSClient.onState(state)
   â†’ Game3dConnector.updateFromGameState(state)
   â†’ Update Babylon.js mesh positions â†’ Render frame

3. Game Over:
   Server detects win â†’ WSClient.onGameOver(winner)
   â†’ Save to database with is_3d=1 â†’ Show UI

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATABASE SCHEMA:

CREATE TABLE games (
  id TEXT PRIMARY KEY,
  room_id TEXT NOT NULL,
  game_type TEXT,          -- 'quickplay' or 'tournament'
  is_3d BOOLEAN DEFAULT 0, -- ğŸ‘ˆ NEW: 0=2D, 1=3D
  player_left_id TEXT,
  player_right_id TEXT,
  score_left INTEGER,
  score_right INTEGER,
  winner_id TEXT,
  ...
);

Query Examples:
  â€¢ 2D games: SELECT * FROM games WHERE is_3d = 0
  â€¢ 3D games: SELECT * FROM games WHERE is_3d = 1
  â€¢ Player's 3D history: SELECT * FROM games WHERE is_3d = 1 
                         AND (player_left_id = ? OR player_right_id = ?)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY INSIGHT:

The backend doesn't know if clients are 2D or 3D!
It just sends positions as (x, y) coordinates.

2D Client: Draws at (x, y) on canvas
3D Client: Converts (x, y) to (x3d, 0, z3d) in 3D space

Same data, different visualization! ğŸ¨

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
